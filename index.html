<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®æ—¶æ±‡ç‡å·®è®¡ç®—å™¨</title>
    <style>
        :root {
            --primary-color: #2563eb;
            --bg-color: #f3f4f6;
            --card-bg: #ffffff;
            --text-color: #1f2937;
            --border-color: #e5e7eb;
            --success-color: #059669;
            --danger-color: #dc2626;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        .container {
            background-color: var(--card-bg);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 450px;
        }
        h2 { text-align: center; margin-bottom: 1.5rem; color: var(--primary-color); }
        .form-group { margin-bottom: 1.25rem; }
        label { display: block; margin-bottom: 0.5rem; font-weight: 600; font-size: 0.9rem; }
        select, input {
            width: 100%; padding: 0.75rem; border: 1px solid var(--border-color);
            border-radius: 6px; font-size: 1rem; box-sizing: border-box;
            transition: border-color 0.2s;
        }
        select:focus, input:focus { outline: none; border-color: var(--primary-color); }
        
        /* æ±‡ç‡å±•ç¤ºåŒºåŸŸä¼˜åŒ– */
        .rate-display {
            background-color: #eff6ff;
            padding: 1rem;
            border-radius: 6px;
            text-align: center;
            margin-bottom: 1rem;
            border: 1px solid #bfdbfe;
            position: relative;
        }
        .rate-display .label { font-size: 0.85rem; color: #6b7280; margin-bottom: 0.25rem; }
        .rate-display .value {
            font-size: 1.5rem; font-weight: bold; color: var(--primary-color);
            font-family: 'Courier New', Courier, monospace;
        }
        .refresh-btn {
            background-color: var(--primary-color); color: white; border: none;
            padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8rem;
            margin-top: 5px; opacity: 0.9;
        }
        .refresh-btn:hover { opacity: 1; }
        .refresh-btn:disabled { background-color: #ccc; cursor: not-allowed; }

        .result-box {
            margin-top: 1.5rem; padding-top: 1.5rem;
            border-top: 1px dashed var(--border-color);
        }
        .result-item { display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-size: 0.95rem; }
        .result-total {
            margin-top: 1rem; font-size: 1.1rem; font-weight: bold;
            display: flex; justify-content: space-between; align-items: center;
            padding: 1rem; border-radius: 6px; background-color: #f9fafb;
        }
        .positive { color: var(--success-color); background-color: #dcfce7 !important; }
        .negative { color: var(--danger-color); background-color: #fee2e2 !important; }
        
        .loading-text { font-size: 0.8rem; color: #666; }
        .api-note { font-size: 0.7rem; color: #9ca3af; text-align: center; margin-top: 1.5rem; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ’± å®æ—¶æ±‡ç‡å·®è®¡ç®—å™¨</h2>

    <div class="form-group">
        <label for="currencySelect">é€‰æ‹©äº¤æ˜“å¸ç§ (åŸºç¡€è´§å¸: USD)</label>
        <select id="currencySelect">
            <option value="CNY">CNY - äººæ°‘å¸</option>
            <option value="EUR">EUR - æ¬§å…ƒ</option>
            <option value="JPY">JPY - æ—¥å…ƒ</option>
            <option value="GBP">GBP - è‹±é•‘</option>
            <option value="AUD">AUD - æ¾³å…ƒ</option>
            <option value="CAD">CAD - åŠ å…ƒ</option>
            <option value="CHF">CHF - ç‘éƒ</option>
            <option value="HKD">HKD - æ¸¯å¸</option>
            <option value="SGD">SGD - æ–°å¸</option>
            <option value="KRW">KRW - éŸ©å…ƒ</option>
        </select>
    </div>

    <div class="rate-display">
        <div class="label">å½“å‰å®æ—¶æ±‡ç‡ (1 USD =)</div>
        <div class="value" id="currentRateDisplay">--</div>
        <button class="refresh-btn" id="refreshBtn" onclick="fetchLiveRate()">ğŸ”„ åˆ·æ–°æ±‡ç‡</button>
        <div id="loadingMsg" class="loading-text" style="display:none;">æ­£åœ¨è·å–æœ€æ–°æ•°æ®...</div>
    </div>

    <div class="form-group">
        <label for="amountInput">äº¤æ˜“é‡‘é¢ (USD)</label>
        <input type="number" id="amountInput" placeholder="è¯·è¾“å…¥é‡‘é¢ï¼Œä¾‹å¦‚ 1000" min="0">
    </div>

    <div class="form-group">
        <label for="targetRateInput">ç›®æ ‡/é¢„æœŸ æ±‡ç‡</label>
        <input type="number" id="targetRateInput" placeholder="æ‰‹åŠ¨è¾“å…¥ç›®æ ‡æ±‡ç‡" step="0.0001">
    </div>

    <div class="result-box" id="resultBox" style="display:none;">
        <div class="result-item">
            <span>æŒ‰å®æ—¶æ±‡ç‡å…‘æ¢:</span>
            <span id="realTotal">0.00</span>
        </div>
        <div class="result-item">
            <span>æŒ‰ç›®æ ‡æ±‡ç‡å…‘æ¢:</span>
            <span id="targetTotal">0.00</span>
        </div>
        
        <div class="result-total" id="diffContainer">
            <span>æ±‡ç‡å·®é¢ (æŸç›Š):</span>
            <span id="diffValue">0.00</span>
        </div>
    </div>

    <div class="api-note">
        æ•°æ®æ¥æº: ExchangeRate-API (å®æ—¶æ›´æ–°)
    </div>
</div>

<script>
    // ğŸ”´ é…ç½®åŒºï¼šè¯·åœ¨è¿™é‡Œæ›¿æ¢ä½ çš„ API Key
    const API_KEY = '71986cc4bfb65581bda0e0dd'; 
    
    // çŠ¶æ€å˜é‡
    let currentCurrency = 'CNY';
    let currentLiveRate = 0;

    // DOM å…ƒç´ 
    const currencySelect = document.getElementById('currencySelect');
    const currentRateDisplay = document.getElementById('currentRateDisplay');
    const amountInput = document.getElementById('amountInput');
    const targetRateInput = document.getElementById('targetRateInput');
    const resultBox = document.getElementById('resultBox');
    const realTotalEl = document.getElementById('realTotal');
    const targetTotalEl = document.getElementById('targetTotal');
    const diffValueEl = document.getElementById('diffValue');
    const diffContainer = document.getElementById('diffContainer');
    const refreshBtn = document.getElementById('refreshBtn');
    const loadingMsg = document.getElementById('loadingMsg');

    // 1. è·å–çœŸå®æ±‡ç‡çš„å‡½æ•°
    async function fetchLiveRate() {
        if (API_KEY === 'YOUR_API_KEY_HERE') {
            alert('è¯·å…ˆåœ¨ä»£ç ä¸­é…ç½®æ‚¨çš„ API Keyï¼');
            return;
        }

        // UI çŠ¶æ€ï¼šåŠ è½½ä¸­
        refreshBtn.disabled = true;
        currentRateDisplay.style.display = 'none';
        loadingMsg.style.display = 'block';

        try {
            // è¯·æ±‚ API: è·å– USD çš„æ‰€æœ‰æ±‡ç‡
            const response = await fetch(`https://v6.exchangerate-api.com/v6/${API_KEY}/latest/USD`);
            const data = await response.json();

            if (data.result === 'success') {
                const rate = data.conversion_rates[currentCurrency];
                currentLiveRate = rate;

                // æ˜¾ç¤ºå¤„ç†
                const digits = (currentCurrency === 'JPY' || currentCurrency === 'KRW') ? 2 : 4;
                currentRateDisplay.innerText = currentLiveRate.toFixed(digits);
                
                // å¦‚æœæœ‰è¾“å…¥é‡‘é¢ï¼Œé‡æ–°è®¡ç®—
                calculate();
            } else {
                currentRateDisplay.innerText = "Error";
                alert('è·å–æ±‡ç‡å¤±è´¥: ' + data['error-type']);
            }
        } catch (error) {
            console.error('Error:', error);
            currentRateDisplay.innerText = "Error";
            alert('ç½‘ç»œé”™è¯¯ï¼Œæ— æ³•è¿æ¥æ±‡ç‡æœåŠ¡å™¨');
        } finally {
            // UI çŠ¶æ€ï¼šæ¢å¤
            refreshBtn.disabled = false;
            currentRateDisplay.style.display = 'block';
            loadingMsg.style.display = 'none';
        }
    }

    // 2. è®¡ç®—é€»è¾‘
    function calculate() {
        const amount = parseFloat(amountInput.value);
        const targetRate = parseFloat(targetRateInput.value);

        if (isNaN(amount) || isNaN(targetRate) || currentLiveRate === 0) {
            resultBox.style.display = 'none';
            return;
        }

        resultBox.style.display = 'block';

        const realTotal = amount * currentLiveRate;
        const targetTotal = amount * targetRate;
        const diff = realTotal - targetTotal;

        const digits = (currentCurrency === 'JPY' || currentCurrency === 'KRW') ? 0 : 2;

        realTotalEl.innerText = `${realTotal.toFixed(digits)} ${currentCurrency}`;
        targetTotalEl.innerText = `${targetTotal.toFixed(digits)} ${currentCurrency}`;
        
        const sign = diff > 0 ? '+' : '';
        diffValueEl.innerText = `${sign}${diff.toFixed(digits)} ${currentCurrency}`;

        // æ ·å¼
        diffContainer.className = 'result-total';
        if (diff > 0) {
            diffContainer.classList.add('positive');
        } else if (diff < 0) {
            diffContainer.classList.add('negative');
        }
    }

    // 3. äº‹ä»¶ç›‘å¬
    currencySelect.addEventListener('change', (e) => {
        currentCurrency = e.target.value;
        targetRateInput.value = ''; // åˆ‡æ¢å¸ç§æ¸…ç©ºç›®æ ‡
        fetchLiveRate(); // åˆ‡æ¢å¸ç§æ—¶è‡ªåŠ¨åˆ·æ–°ä¸€æ¬¡
    });

    amountInput.addEventListener('input', calculate);
    targetRateInput.addEventListener('input', calculate);

    // åˆå§‹åŒ–ï¼šé¡µé¢åŠ è½½æ—¶è·å–ä¸€æ¬¡æ•°æ®
    fetchLiveRate();

</script>
</body>
</html>